@page
@model RazorComponents.Pages.SampleUses.EditArrayTagHelper.Edit

<h2>Edit Person</h2>

<form method="post">
    <div class="form-group">
        <label asp-for="Person.FirstName">First Name</label>
        <input asp-for="Person.FirstName" class="form-control" />
    </div>
    <div class="form-group">
        <label asp-for="Person.LastName">Last Name</label>
        <input asp-for="Person.LastName" class="form-control" />
    </div>

    <h3>Addresses</h3>
    <edit-array 
        asp-items="@Model.Person.Addresses" 
        asp-view-name="~/Pages/Shared/EditorTemplates/Address.cshtml" 
        asp-display-view-name="~/Pages/Shared/DisplayTemplates/Address.cshtml"
        asp-for="Person.Addresses" 
        asp-template="true" 
        asp-add-button="true"
        asp-display-mode="true"
        id="addresses"
        asp-on-update="onUpdate">
    </edit-array>

    <div class="form-group mt-4">
        <button type="submit" class="btn btn-primary">Save</button>
    </div>
</form>

@section Scripts {
    <script>
        function onUpdate(itemId) {
            const item = document.getElementById(itemId);
            if (!item) return;

            const editContainer = document.getElementById(`${itemId}-edit`);

            // Handle the update event here
            const inputs = editContainer.querySelectorAll('input, select, textarea');
            // create a string with all the values
            let values = '';
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    values += `${input.name}: ${input.checked}\n`;
                } else {
                    values += `${input.name}: ${input.value}\n`;
                }
            });
            // log the values to the console
            console.log(`Updated item ${itemId} with values:\n${values}`);

            
        }
    </script>
}


